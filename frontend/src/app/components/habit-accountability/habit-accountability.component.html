<div class="accountability-container">
  <div class="nav-tabs">
    <a routerLink="/habits" class="tab-link">Habits</a>
    <a routerLink="/habits/overview" class="tab-link">Overview</a>
    <a routerLink="/habits/accountability" class="tab-link active">Accountability</a>
  </div>

  @if (error()) {
    <div class="error" (click)="clearError()">
      {{ error() }}
      <span class="error-close">X</span>
    </div>
  }

  @if (isLoading()) {
    <div class="loading">Loading...</div>
  } @else {
    <!-- Today's Progress -->
    <div class="section progress-section">
      <h2 class="section-title">Today's Progress</h2>
      <div class="progress-stats">
        <span class="progress-count">{{ habitsCompletedToday() }}/{{ todaysHabits().length }} habits completed</span>
        <span class="progress-percent" [class.goal-met]="goalMet()" [class.goal-missed]="!goalMet()">
          {{ progressPercent() }}%
        </span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressPercent()"></div>
        <div class="goal-marker" [style.left.%]="settings().goalPercentage"></div>
      </div>
      <div class="goal-status" [class.met]="goalMet()" [class.missed]="!goalMet()">
        @if (goalMet()) {
          Goal met!
        } @else {
          {{ settings().goalPercentage - progressPercent() }}% more to reach goal
        }
      </div>
    </div>

    <!-- Goal Setting -->
    <div class="section goal-section">
      <h2 class="section-title">Daily Goal</h2>
      <p class="section-description">Set your daily habit completion target percentage.</p>
      <div class="goal-input-row">
        <div class="goal-input-group">
          <input
            type="text"
            class="goal-input"
            [ngModel]="goalInput()"
            (ngModelChange)="onGoalInputChange($event)"
            (keyup.enter)="updateGoal()"
          />
          <span class="goal-suffix">%</span>
        </div>
        <button class="btn-save" (click)="updateGoal()" [disabled]="goalInput() === settings().goalPercentage">Save</button>
      </div>
    </div>

    <div class="two-column">
      <!-- Penalties Section -->
      <div class="section penalties-section">
        <h2 class="section-title">Penalties</h2>
        <p class="section-description">Consequences when you miss your daily goal.</p>

        <div class="add-item-form">
          <input
            type="text"
            class="item-input"
            placeholder="Add a penalty..."
            [ngModel]="newPenalty()"
            (ngModelChange)="newPenalty.set($event)"
            (keyup.enter)="addPenalty()"
          />
          <button class="btn-add penalty" (click)="addPenalty()" [disabled]="!newPenalty().trim()">Add</button>
        </div>

        <ul class="item-list">
          @for (penalty of settings().penalties; track penalty.id) {
            <li class="item" [class.highlighted]="selectedPenalty()?.id === penalty.id">
              <span class="item-text">{{ penalty.description }}</span>
              <button class="btn-remove" (click)="removePenalty(penalty.id)">X</button>
            </li>
          } @empty {
            <li class="empty-item">No penalties added yet</li>
          }
        </ul>

        @if (settings().penalties.length >= 2) {
          <button class="btn-random penalty" (click)="pickRandomPenalty()">Pick Random</button>
        }
      </div>

      <!-- Rewards Section -->
      <div class="section rewards-section">
        <h2 class="section-title">Rewards</h2>
        <p class="section-description">Treats when you meet your daily goal.</p>

        <div class="add-item-form">
          <input
            type="text"
            class="item-input"
            placeholder="Add a reward..."
            [ngModel]="newReward()"
            (ngModelChange)="newReward.set($event)"
            (keyup.enter)="addReward()"
          />
          <button class="btn-add reward" (click)="addReward()" [disabled]="!newReward().trim()">Add</button>
        </div>

        <ul class="item-list">
          @for (reward of settings().rewards; track reward.id) {
            <li class="item" [class.highlighted]="selectedReward()?.id === reward.id">
              <span class="item-text">{{ reward.description }}</span>
              <button class="btn-remove" (click)="removeReward(reward.id)">X</button>
            </li>
          } @empty {
            <li class="empty-item">No rewards added yet</li>
          }
        </ul>

        @if (settings().rewards.length >= 2) {
          <button class="btn-random reward" (click)="pickRandomReward()">Pick Random</button>
        }
      </div>
    </div>
  }
</div>
